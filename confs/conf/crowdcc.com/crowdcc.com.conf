# --------------------------------------
# crowdcc.com v1.00.00 | apache2 * conf
# --------------------------------------

# ref : http://www.petefreitag.com/item/505.cfm

# Make sure only root has read access to apache's config and binaries
# This can be done assuming your apache installation is located at /usr/local/apache as follows:
#
# chown -R root:root /usr/local/apache
# chmod -R o-rwx /usr/local/apache

# Disable any unnecessary modules
# mod_imap, mod_include, mod_info, mod_userdir, mod_status, mod_cgi, mod_autoindex.

<VirtualHost *:80>

# Specify a Default Charset
AddDefaultCharset utf-8
AddCharset utf-8 .html .css .php .txt .js

ServerAdmin crowdccsrv@gmail.com
ServerName crowdcc.com
ServerAlias crowdcc.com
DocumentRoot /var/www/crowdcc.com/public_html

# * change MaxKeepAliveRequests which defaults to 100, and the KeepAliveTimeout which defaults to 15.
KeepAlive Off

# security start

<IfModule mod_headers.c>

Header unset Server
Header unset Accept-Ranges
Header unset Content-Length
Header unset Keep-Alive
Header unset Connection
Header always unset Server
Header unset X-Powered-By
Header always unset X-Powered-By
Header set X-Frame-Options SAMEORIGIN
Header set X-XSS-Protection: "1; mode=block"
Header set X-Content-Type-Options nosniff
Header unset Vary

#Header always set Strict-Transport-Security "max-age=631138519"

Header set Cache-Control "no-cache, no-store, must-revalidate, pre-check=0, post-check=0"
Header set Pragma "no-cache"

# Header set Expires "tue, 31 mar 1981 05:00:00 gmt"
# Header edit Set-Cookie ^(.*)$ $1;HttpOnly;Secure

# host : crowdcc.com

# Header Set Content-Security-Policy-Report-Only: "default-src 'self' http://crowdcc.com; script-src 'self' data: 'unsafe-inline' http://crowdcc.com; object-src 'self'; style-src 'unsafe-inline' http://crowdcc.com http://crowdcc.com/css; img-src * 'self' data: blob:; media-src 'self' http://crowdcc.com; frame-src 'none';font-src 'self' http://crowdcc.com; connect-src *;report-uri /sbin/csp.app.notice.php"

# Header Set X-Content-Security-Policy-Report-Only: "default-src 'self' http://crowdcc.com; script-src 'self' data: 'unsafe-inline' http://crowdcc.com; object-src 'self';style-src 'unsafe-inline' http://crowdcc.com http://crowdcc.com/css; img-src * 'self' data: blob:; media-src 'self' http://crowdcc.com; frame-src 'none';font-src 'self' http://crowdcc.com; connect-src *;report-uri /sbin/csp.app.notice.php"

# Header Set X-WebKit-CSP-Report-Only: "default-src 'self' http://crowdcc.com; script-src 'self' data: 'unsafe-inline' http://crowdcc.com; object-src 'self'; style-src 'unsafe-inline' http://crowdcc.com http://crowdcc.com/css; img-src * 'self' data: blob:; media-src 'self' http://crowdcc.com; frame-src 'none';font-src 'self' http://crowdcc.com; connect-src *;report-uri /sbin/csp.app.notice.php"

Header Set Content-Security-Policy: "default-src 'self' http://crowdcc.com; script-src 'self' data: 'unsafe-inline' http://crowdcc.com; object-src 'self'; style-src 'unsafe-inline' http://crowdcc.com http://crowdcc.com/css; img-src * 'self' data: blob:; media-src 'self' http://crowdcc.com; frame-src 'none';font-src 'self' http://crowdcc.com; connect-src *;report-uri /sbin/csp.app.notice.php"

Header Set X-Content-Security-Policy: "default-src 'self' http://crowdcc.com; script-src 'self' data: 'unsafe-inline' http://crowdcc.com; object-src 'self';style-src 'unsafe-inline' http://crowdcc.com http://crowdcc.com/css; img-src * 'self' data: blob:; media-src 'self' http://crowdcc.com; frame-src 'none';font-src 'self' http://crowdcc.com; connect-src *;report-uri /sbin/csp.app.notice.php"

Header Set X-WebKit-CSP: "default-src 'self' http://crowdcc.com; script-src 'self' data: 'unsafe-inline' http://crowdcc.com; object-src 'self'; style-src 'unsafe-inline' http://crowdcc.com http://crowdcc.com/css; img-src * 'self' data: blob:; media-src 'self' http://crowdcc.com; frame-src 'none';font-src 'self' http://crowdcc.com; connect-src *;report-uri /sbin/csp.app.notice.php"

Header add ccstatus "200, 200 ok"

Header add ccstatus "200, 200 ok"

</IfModule>

# disable HTTP 1.0 Protocol

<IfModule mod_rewrite.c>
 RewriteEngine On
 RewriteCond %{THE_REQUEST} !HTTP/1.1$
 RewriteRule .* - [F]
</IfModule>

# security end

# php file accessed without .php extention

<IfModule mod_rewrite.c>
 RewriteEngine on
 RewriteCond %{REQUEST_FILENAME} !-d
 RewriteCond %{REQUEST_FILENAME}\.php -f
 RewriteRule ^(.*)$ $1.php
</IfModule>

<Directory /var/www/crowdcc.com/public_html/shed>
 AuthType Basic
 AuthName "Restricted Access"
 AuthUserFile /var/www/crowdcc.com/passin/htpasswd
 Require valid-user
</Directory>

<Directory /var/www/crowdcc.com/public_html>
  Options FollowSymLinks MultiViews
  AllowOverride None
  Order allow,deny
  allow from all
</Directory>

<Directory />
  # Ensure that files outside the web root are not served ( check that scripts still run! )
  Order Deny,Allow
  Deny from all
  Options None
  AllowOverride None
</Directory>

<Directory /var/www/crowdcc.com/public_html>

  php_admin_value open_basedir "/var/www/crowdcc.com/"
  # php_admin_value open_basedir "/var/www/u/s/username/:/shared/path/"

  ExpiresActive On
  ExpiresDefault "access plus 1 day"
 <filesMatch ".(ico|jpg|jpeg|png|gif)$">
  ExpiresActive On
  ExpiresDefault "access plus 30 days"
 </filesMatch>
 <FilesMatch ".(txt|xml|js|css)$">
  ExpiresActive On
  ExpiresDefault "access plus 30 days"
 </FilesMatch>
</Directory>

<FilesMatch "\.(ico|pdf|flv|jpg|jpeg|png|gif|js|css|swf)(\.gz)?$">
 ExpiresActive On
 ExpiresDefault "access plus 30 days"
 Header unset ETag
 FileETag None
</FilesMatch>

<IfModule mod_mime.c>
 AddType application/vnd.ms-fontobject eot
 AddType application/x-font-ttf ttf ttc
 AddType font/opentype otf
 AddType application/x-font-woff woff
 AddEncoding gzip svgz
</Ifmodule>

<ifModule mod_deflate.c>
 AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/x-javascript application/json
 BrowserMatch ^Mozilla/4 gzip-only-text/html
 BrowserMatch ^Mozilla/4\.0[678] no-gzip
 BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
</ifModule>

<ifModule mod_gzip.c>
 mod_gzip_on Yes
 mod_gzip_dechunk Yes

 mod_gzip_keep_workfiles No
 mod_gzip_minimum_file_size  300
 mod_gzip_maximum_file_size  1000000
 mod_gzip_maximum_inmem_size 1000000
 mod_gzip_item_include file .(html?|txt|css|js|php|pl)$

 mod_gzip_item_include mime ^text/.*
 mod_gzip_item_include mime ^application/javascript.*
 mod_gzip_item_include mime ^application/x-javascript$
 mod_gzip_item_include mime ^application/json$
 mod_gzip_item_exclude mime ^image/.*$
 mod_gzip_item_exclude reqheader "User-Agent: .*Mozilla/4..*["
 mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
</ifModule>

# $HTTP_RAW_POST_DATA is deprecated (update php.ini)
php_value always_populate_raw_post_data -1

# Possible values include: debug, info, notice, warn, error, crit, alert, emerg.
LogLevel warn

ErrorLog /var/www/crowdcc.com/logs/error.log
CustomLog /var/www/crowdcc.com/logs/access.log combined

#ErrorLog ${APACHE_LOG_DIR}/error.log
#CustomLog ${APACHE_LOG_DIR}/access.log combined

ErrorDocument 505 /error_html/505.html
ErrorDocument 504 /error_html/504.html
ErrorDocument 503 /error_html/503.html
ErrorDocument 502 /error_html/502.html
ErrorDocument 501 /error_html/501.html
ErrorDocument 500 /error_html/500.html
ErrorDocument 415 /error_html/415.html
ErrorDocument 414 /error_html/414.html
ErrorDocument 413 /error_html/413.html
ErrorDocument 412 /error_html/412.html
ErrorDocument 411 /error_html/411.html
ErrorDocument 410 /error_html/410.html
ErrorDocument 409 /error_html/409.html
ErrorDocument 408 /error_html/408.html
ErrorDocument 407 /error_html/407.html
ErrorDocument 406 /error_html/406.html
ErrorDocument 405 /error_html/405.html
ErrorDocument 404 /error_html/404.html
ErrorDocument 403 /error_html/403.html
ErrorDocument 402 /error_html/402.html
ErrorDocument 401 /error_html/401.html
ErrorDocument 301 /error_html/301.html

</VirtualHost>
