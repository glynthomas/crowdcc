
# crowdcc.com.conf v1.00.00 | apache2 | sites-available | configuration * performance * security | (c) 2015 crowdcc.

# security * attempt to disable apache server signature
  ServerSignature Off
  ServerTokens Prod

  # Set default file type to PHP
  # DefaultType application/x-httpd-php

<VirtualHost *:80>

  ServerAdmin crowdccsrv@gmail.com
  ServerName crowdcc.com

# security * disable http trace from certain cross script attacks 
  TraceEnable Off

  ServerAlias www.crowdcc.com
  DocumentRoot /var/www/crowdcc.com/public_html/
  ErrorLog /var/www/crowdcc.com/logs/apache.error.log

# possible values include: debug, info, notice, warn, error, crit, alert, emerg.
  LogLevel warn 

  CustomLog /var/www/crowdcc.com/logs/apache.access.log combined

# PHP generic error handling * crowdcc app * php error handle * require_once('db/errorhandle.php');

  #php_flag log_errors on
  #php_flag display_errors on
  #php_value error_reporting 2147483647
  #php_value error_log /var/www/crowdcc.com/logs/php.error.log

# basic security start

  <IfModule mod_headers.c>
   Header unset ETag
   Header set X-Frame-Options: SAMEORIGIN
   Header set X-XSS-Protection: "1; mode=block"
   Header set X-Content-Type-Options: nosniff
   # Header set X-WebKit-CSP: "default-src 'self'"
   # Header set X-Permitted-Cross-Domain-Policies: "master-only"
  </IfModule>

# disable HTTP 1.0 Protocol

  #<IfModule mod_rewrite.c>
  # RewriteEngine On
  # RewriteCond %{SERVER_PROTOCOL} ^HTTP/1\.0$
  # RewriteRule ^.* -  [F]
  #</IfModule>

  #<DirectoryMatch "/var/www/crowdcc.com/public_html/">
  # php_admin_value open_basedir "/var/www/crowdcc.com/public_html/"
  #</DirectoryMatch>

# canonical sitemaps

  <IfModule mod_alias.c>
    RedirectMatch 301 /sitemap\.xml$ http://crowdcc.com/sitemap.xml
    RedirectMatch 301 /sitemap\.xml\.gz$ http://crowdcc.com/sitemap.xml.gz
  </IfModule>

# canonical URLS

  <IfModule mod_alias.c>
    RedirectMatch 301 ^/tag/$      http://crowdcc.com/
    RedirectMatch 301 ^/search/$   http://crowdcc.com/
    RedirectMatch 301 ^/category/$ http://crowdcc.com/
  </IfModule>

# prevent access to PHP error log

  <Files PHP_errors.log>
    Order allow,deny
    Deny from all
    Satisfy All
  </Files>

# deny access to all other .log and .comment files

  <Files ~ "^.*\.([Ll][Oo][Gg]|[cC][oO][mM][mM][eE][nN][tT])">
    Order allow,deny
    Deny from all
    Satisfy All
  </Files>

# basic security end


# auth access

  <Directory /var/www/crowdcc.com/public_html/shed/>
   AuthType Basic
   AuthName "Restricted Files"
   AuthUserFile /var/www/crowdcc.com/public_html/passin/.htpasswd
   Require valid-user
  </Directory>


# performance * expires headers * cache control * versioning with filename-based cache busting

  #<Directory />
  # Options FollowSymLinks
  # AllowOverride None
  #</Directory>
    
  <Directory /var/www/crowdcc.com/pubic_html/ >
   # (warning * Indexes is for browsing directories)
   # Options Indexes FollowSymLinks MultiViews
   Options Includes FollowSymLinks MultiViews
   AllowOverride None
   Order allow,deny
   /* allow from all * chgd in Apache 2.4+ * Require all granted */
   Require all granted

   ExpiresActive On
   ExpiresDefault "access plus 1 day"

   <filesMatch ".(ico|jpg|jpeg|png|gif)$">
     ExpiresActive On
     ExpiresDefault "access plus 30 days"
   </filesMatch>
   <FilesMatch ".(txt|xml|js|css)$">
     ExpiresActive On
     ExpiresDefault "access plus 30 days"
   </FilesMatch>
  </Directory>

  <FilesMatch "\.(ico|pdf|flv|jpg|jpeg|png|gif|js|css|swf)(\.gz)?$">
   Header unset ETag
   FileETag None
  </FilesMatch>

  <ifModule mod_deflate.c>
   AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/x-javascript
   BrowserMatch ^Mozilla/4 gzip-only-text/html
   BrowserMatch ^Mozilla/4\.0[678] no-gzip
   BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
  </ifModule>

  <ifModule mod_gzip.c>
   mod_gzip_on Yes
   mod_gzip_dechunk Yes
   mod_gzip_item_include file .(html?|txt|css|js|php|pl)$
   mod_gzip_item_include handler ^cgi-script$
   mod_gzip_item_include mime ^text/.*
   mod_gzip_item_include mime ^application/x-javascript.*
   mod_gzip_item_exclude mime ^image/.*
   mod_gzip_item_exclude rspheader ^Content-Encoding:.*gzip.*
  </ifModule>

# errorhandle

  ErrorDocument 500 /error_html/500.html
  ErrorDocument 404 /error_html/404.html
  ErrorDocument 403 /error_html/403.html
  ErrorDocument 401 /error_html/401.html
  ErrorDocument 301 /error_html/301.html

</VirtualHost>